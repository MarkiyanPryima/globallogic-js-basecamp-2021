{"ast":null,"code":"import _regeneratorRuntime from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{useEffect,useState}from'react';import{useParams,useHistory}from'react-router-dom';import cityApi from'../../../api/cityApi';import{MODE}from'../../../constants';import{ID}from'../constants';import FormContainer from'./FormContainer';import{getInitialValues,getRequestPayload}from'./converter';import{jsx as _jsx}from\"react/jsx-runtime\";function CityForm(_ref){var cities=_ref.cities,setCities=_ref.setCities;var _useParams=useParams(),mode=_useParams.mode,id=_useParams.id;var history=useHistory();var city=cities.find(function(city){return city.id===Number(id);});useEffect(function(){if(mode===MODE.VIEW||mode===MODE.EDIT){if(!city){cityApi.getCity(Number(id)).then(function(city){return setCities(function(prevCities){return[].concat(_toConsumableArray(prevCities),[city]);});}).catch(function(err){return window.alert(err.message);});}}},[id,mode,city,setCities]);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),statuses=_useState2[0],setStatuses=_useState2[1];useEffect(function(){cityApi.getStatuses().then(setStatuses);},[setStatuses]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var payload;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;payload=getRequestPayload(values);_context.t0=mode;_context.next=_context.t0===MODE.CREATE?5:_context.t0===MODE.EDIT?8:_context.t0===MODE.CLONE?11:_context.t0===MODE.DELETE?14:17;break;case 5:_context.next=7;return cityApi.createCity(payload);case 7:return _context.abrupt(\"break\",18);case 8:_context.next=10;return cityApi.createCity(payload);case 10:return _context.abrupt(\"break\",18);case 11:_context.next=13;return cityApi.createCity(payload);case 13:return _context.abrupt(\"break\",18);case 14:_context.next=16;return cityApi.deleteCity(payload);case 16:return _context.abrupt(\"break\",18);case 17:console.error(\"Failed to execute this request for \".concat(mode,\" mode\"));case 18:_context.next=23;break;case 20:_context.prev=20;_context.t1=_context[\"catch\"](0);window.alert(_context.t1.message);case 23:history.push('/cities');case 24:case\"end\":return _context.stop();}}},_callee,null,[[0,20]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var initialValues=getInitialValues(city);return/*#__PURE__*/_jsx(FormContainer,{initialValues:initialValues,onSubmit:handleSubmit,mode:mode,statuses:statuses},\"\".concat(mode,\":\").concat(initialValues[ID]));}export default CityForm;","map":{"version":3,"sources":["/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/src/components/Cities/CityForm/index.jsx"],"names":["useEffect","useState","useParams","useHistory","cityApi","MODE","ID","FormContainer","getInitialValues","getRequestPayload","CityForm","cities","setCities","mode","id","history","city","find","Number","VIEW","EDIT","getCity","then","prevCities","catch","err","window","alert","message","statuses","setStatuses","getStatuses","handleSubmit","values","payload","CREATE","CLONE","DELETE","createCity","deleteCity","console","error","push","initialValues"],"mappings":"6zBAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,SAAT,CAAoBC,UAApB,KAAsC,kBAAtC,CAEA,MAAOC,CAAAA,OAAP,KAAoB,sBAApB,CACA,OAASC,IAAT,KAAqB,oBAArB,CACA,OAASC,EAAT,KAAmB,cAAnB,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,OAASC,gBAAT,CAA2BC,iBAA3B,KAAoD,aAApD,C,2CAEA,QAASC,CAAAA,QAAT,MAAyC,IAArBC,CAAAA,MAAqB,MAArBA,MAAqB,CAAbC,SAAa,MAAbA,SAAa,gBAClBV,SAAS,EADS,CAC/BW,IAD+B,YAC/BA,IAD+B,CACzBC,EADyB,YACzBA,EADyB,CAEvC,GAAMC,CAAAA,OAAO,CAAGZ,UAAU,EAA1B,CAEA,GAAMa,CAAAA,IAAI,CAAGL,MAAM,CAACM,IAAP,CAAY,SAAAD,IAAI,QAAIA,CAAAA,IAAI,CAACF,EAAL,GAAYI,MAAM,CAACJ,EAAD,CAAtB,EAAhB,CAAb,CAEAd,SAAS,CAAC,UAAM,CACd,GAAIa,IAAI,GAAKR,IAAI,CAACc,IAAd,EAAsBN,IAAI,GAAKR,IAAI,CAACe,IAAxC,CAA8C,CAC5C,GAAI,CAACJ,IAAL,CAAW,CACTZ,OAAO,CACJiB,OADH,CACWH,MAAM,CAACJ,EAAD,CADjB,EAEGQ,IAFH,CAEQ,SAAAN,IAAI,QAAIJ,CAAAA,SAAS,CAAC,SAAAW,UAAU,qCAAQA,UAAR,GAAoBP,IAApB,IAAX,CAAb,EAFZ,EAGGQ,KAHH,CAGS,SAAAC,GAAG,QAAIC,CAAAA,MAAM,CAACC,KAAP,CAAaF,GAAG,CAACG,OAAjB,CAAJ,EAHZ,EAID,CACF,CACF,CATQ,CASN,CAACd,EAAD,CAAKD,IAAL,CAAWG,IAAX,CAAiBJ,SAAjB,CATM,CAAT,CANuC,cAiBPX,QAAQ,CAAC,EAAD,CAjBD,wCAiBhC4B,QAjBgC,eAiBtBC,WAjBsB,eAkBvC9B,SAAS,CAAC,UAAM,CACdI,OAAO,CAAC2B,WAAR,GAAsBT,IAAtB,CAA2BQ,WAA3B,EACD,CAFQ,CAEN,CAACA,WAAD,CAFM,CAAT,CAIA,GAAME,CAAAA,YAAY,2FAAG,iBAAMC,MAAN,8IAEXC,OAFW,CAEDzB,iBAAiB,CAACwB,MAAD,CAFhB,aAITpB,IAJS,6BAKVR,IAAI,CAAC8B,MALK,iBAQV9B,IAAI,CAACe,IARK,iBAWVf,IAAI,CAAC+B,KAXK,kBAcV/B,IAAI,CAACgC,MAdK,0CAMPjC,CAAAA,OAAO,CAACkC,UAAR,CAAmBJ,OAAnB,CANO,yEASP9B,CAAAA,OAAO,CAACkC,UAAR,CAAmBJ,OAAnB,CATO,2EAYP9B,CAAAA,OAAO,CAACkC,UAAR,CAAmBJ,OAAnB,CAZO,2EAeP9B,CAAAA,OAAO,CAACmC,UAAR,CAAmBL,OAAnB,CAfO,oDAkBbM,OAAO,CAACC,KAAR,8CAAoD5B,IAApD,WAlBa,yFAqBjBa,MAAM,CAACC,KAAP,CAAa,YAAIC,OAAjB,EArBiB,QAwBnBb,OAAO,CAAC2B,IAAR,CAAa,SAAb,EAxBmB,qEAAH,kBAAZV,CAAAA,YAAY,6CAAlB,CA2BA,GAAMW,CAAAA,aAAa,CAAGnC,gBAAgB,CAACQ,IAAD,CAAtC,CAEA,mBAEE,KAAC,aAAD,EAEE,aAAa,CAAE2B,aAFjB,CAGE,QAAQ,CAAEX,YAHZ,CAIE,IAAI,CAAEnB,IAJR,CAKE,QAAQ,CAAEgB,QALZ,YACUhB,IADV,aACkB8B,aAAa,CAACrC,EAAD,CAD/B,EAFF,CAUD,CAED,cAAeI,CAAAA,QAAf","sourcesContent":["import { useEffect, useState } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\n\nimport cityApi from '../../../api/cityApi';\nimport { MODE } from '../../../constants';\nimport { ID } from '../constants';\nimport FormContainer from './FormContainer';\nimport { getInitialValues, getRequestPayload } from './converter';\n\nfunction CityForm({ cities, setCities }) {\n  const { mode, id } = useParams();\n  const history = useHistory();\n\n  const city = cities.find(city => city.id === Number(id));\n\n  useEffect(() => {\n    if (mode === MODE.VIEW || mode === MODE.EDIT) {\n      if (!city) {\n        cityApi\n          .getCity(Number(id))\n          .then(city => setCities(prevCities => [...prevCities, city]))\n          .catch(err => window.alert(err.message));\n      }\n    }\n  }, [id, mode, city, setCities]);\n\n  const [statuses, setStatuses] = useState([]);\n  useEffect(() => {\n    cityApi.getStatuses().then(setStatuses);\n  }, [setStatuses]);\n\n  const handleSubmit = async values => {\n    try {\n      const payload = getRequestPayload(values);\n\n      switch (mode) {\n        case MODE.CREATE:\n          await cityApi.createCity(payload);\n          break;\n        case MODE.EDIT:\n          await cityApi.createCity(payload);\n          break;\n        case MODE.CLONE:\n          await cityApi.createCity(payload);\n          break;\n        case MODE.DELETE:\n          await cityApi.deleteCity(payload);\n          break;\n        default:\n          console.error(`Failed to execute this request for ${mode} mode`);\n      }\n    } catch (err) {\n      window.alert(err.message);\n    }\n\n    history.push('/cities');\n  };\n\n  const initialValues = getInitialValues(city);\n\n  return (\n\n    <FormContainer\n      key={`${mode}:${initialValues[ID]}`}\n      initialValues={initialValues}\n      onSubmit={handleSubmit}\n      mode={mode}\n      statuses={statuses}\n    />\n  );\n}\n\nexport default CityForm;\n"]},"metadata":{},"sourceType":"module"}