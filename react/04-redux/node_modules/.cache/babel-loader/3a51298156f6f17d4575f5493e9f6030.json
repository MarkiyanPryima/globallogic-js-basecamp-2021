{"ast":null,"code":"import _regeneratorRuntime from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{useEffect,useState}from'react';import{useParams,useHistory}from'react-router-dom';import userApi from'../../../api/userApi';import{MODE}from'../../../constants';import{ID}from'../constants';import FormContainer from'./FormContainer';import{getInitialValues,getRequestPayload}from'./converter';import{jsx as _jsx}from\"react/jsx-runtime\";function UserForm(_ref){var users=_ref.users,setUsers=_ref.setUsers;var _useParams=useParams(),mode=_useParams.mode,id=_useParams.id;var history=useHistory();var user=users.find(function(user){return user.id===Number(id);});useEffect(function(){if(mode===MODE.VIEW||mode===MODE.EDIT){if(!user){userApi.getUser(Number(id)).then(function(user){return setUsers(function(prevUsers){return[].concat(_toConsumableArray(prevUsers),[user]);});}).catch(function(err){return window.alert(err.message);});}}},[id,mode,user,setUsers]);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),roles=_useState2[0],setRoles=_useState2[1];useEffect(function(){userApi.getRoles().then(setRoles);},[setUsers]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var payload;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;payload=getRequestPayload(values);_context.t0=mode;_context.next=_context.t0===MODE.CREATE?5:_context.t0===MODE.EDIT?8:_context.t0===MODE.CLONE?11:_context.t0===MODE.DELETE?14:17;break;case 5:_context.next=7;return userApi.createUser(payload);case 7:return _context.abrupt(\"break\",18);case 8:_context.next=10;return userApi.editUser(payload);case 10:return _context.abrupt(\"break\",18);case 11:_context.next=13;return userApi.createUser(payload);case 13:return _context.abrupt(\"break\",18);case 14:_context.next=16;return userApi.deleteUser(payload);case 16:return _context.abrupt(\"break\",18);case 17:console.error(\"Failed to execute this request for \".concat(mode,\" mode\"));case 18:_context.next=23;break;case 20:_context.prev=20;_context.t1=_context[\"catch\"](0);window.alert(_context.t1.message);case 23:history.push('/users');case 24:case\"end\":return _context.stop();}}},_callee,null,[[0,20]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var initialValues=getInitialValues(user);return/*#__PURE__*/_jsx(FormContainer,{initialValues:initialValues,onSubmit:handleSubmit,mode:mode,roles:roles},\"\".concat(mode,\":\").concat(initialValues[ID]));}export default UserForm;","map":{"version":3,"sources":["/Users/markiyanpryima/Desktop/globallogic-js-basecamp-2021/react/03-react-router-formik/src/components/Users/UserForm/index.jsx"],"names":["useEffect","useState","useParams","useHistory","userApi","MODE","ID","FormContainer","getInitialValues","getRequestPayload","UserForm","users","setUsers","mode","id","history","user","find","Number","VIEW","EDIT","getUser","then","prevUsers","catch","err","window","alert","message","roles","setRoles","getRoles","handleSubmit","values","payload","CREATE","CLONE","DELETE","createUser","editUser","deleteUser","console","error","push","initialValues"],"mappings":"6zBAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,SAAT,CAAoBC,UAApB,KAAsC,kBAAtC,CAEA,MAAOC,CAAAA,OAAP,KAAoB,sBAApB,CACA,OAASC,IAAT,KAAqB,oBAArB,CACA,OAASC,EAAT,KAAmB,cAAnB,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,OAASC,gBAAT,CAA2BC,iBAA3B,KAAoD,aAApD,C,2CAEA,QAASC,CAAAA,QAAT,MAAuC,IAAnBC,CAAAA,KAAmB,MAAnBA,KAAmB,CAAZC,QAAY,MAAZA,QAAY,gBAChBV,SAAS,EADO,CAC7BW,IAD6B,YAC7BA,IAD6B,CACvBC,EADuB,YACvBA,EADuB,CAErC,GAAMC,CAAAA,OAAO,CAAGZ,UAAU,EAA1B,CAEA,GAAMa,CAAAA,IAAI,CAAGL,KAAK,CAACM,IAAN,CAAW,SAAAD,IAAI,QAAIA,CAAAA,IAAI,CAACF,EAAL,GAAYI,MAAM,CAACJ,EAAD,CAAtB,EAAf,CAAb,CAEAd,SAAS,CAAC,UAAM,CACd,GAAIa,IAAI,GAAKR,IAAI,CAACc,IAAd,EAAsBN,IAAI,GAAKR,IAAI,CAACe,IAAxC,CAA8C,CAC5C,GAAI,CAACJ,IAAL,CAAW,CACTZ,OAAO,CACJiB,OADH,CACWH,MAAM,CAACJ,EAAD,CADjB,EAEGQ,IAFH,CAEQ,SAAAN,IAAI,QAAIJ,CAAAA,QAAQ,CAAC,SAAAW,SAAS,qCAAQA,SAAR,GAAmBP,IAAnB,IAAV,CAAZ,EAFZ,EAGGQ,KAHH,CAGS,SAAAC,GAAG,QAAIC,CAAAA,MAAM,CAACC,KAAP,CAAaF,GAAG,CAACG,OAAjB,CAAJ,EAHZ,EAID,CACF,CACF,CATQ,CASN,CAACd,EAAD,CAAKD,IAAL,CAAWG,IAAX,CAAiBJ,QAAjB,CATM,CAAT,CANqC,cAiBXX,QAAQ,CAAC,EAAD,CAjBG,wCAiB9B4B,KAjB8B,eAiBvBC,QAjBuB,eAkBrC9B,SAAS,CAAC,UAAM,CACdI,OAAO,CAAC2B,QAAR,GAAmBT,IAAnB,CAAwBQ,QAAxB,EACD,CAFQ,CAEN,CAAClB,QAAD,CAFM,CAAT,CAIA,GAAMoB,CAAAA,YAAY,2FAAG,iBAAMC,MAAN,8IAEXC,OAFW,CAEDzB,iBAAiB,CAACwB,MAAD,CAFhB,aAITpB,IAJS,6BAKVR,IAAI,CAAC8B,MALK,iBAQV9B,IAAI,CAACe,IARK,iBAWVf,IAAI,CAAC+B,KAXK,kBAcV/B,IAAI,CAACgC,MAdK,0CAMPjC,CAAAA,OAAO,CAACkC,UAAR,CAAmBJ,OAAnB,CANO,yEASP9B,CAAAA,OAAO,CAACmC,QAAR,CAAiBL,OAAjB,CATO,2EAYP9B,CAAAA,OAAO,CAACkC,UAAR,CAAmBJ,OAAnB,CAZO,2EAeP9B,CAAAA,OAAO,CAACoC,UAAR,CAAmBN,OAAnB,CAfO,oDAkBbO,OAAO,CAACC,KAAR,8CAAoD7B,IAApD,WAlBa,yFAqBjBa,MAAM,CAACC,KAAP,CAAa,YAAIC,OAAjB,EArBiB,QAwBnBb,OAAO,CAAC4B,IAAR,CAAa,QAAb,EAxBmB,qEAAH,kBAAZX,CAAAA,YAAY,6CAAlB,CA2BA,GAAMY,CAAAA,aAAa,CAAGpC,gBAAgB,CAACQ,IAAD,CAAtC,CAEA,mBACE,KAAC,aAAD,EAEE,aAAa,CAAE4B,aAFjB,CAGE,QAAQ,CAAEZ,YAHZ,CAIE,IAAI,CAAEnB,IAJR,CAKE,KAAK,CAAEgB,KALT,YACUhB,IADV,aACkB+B,aAAa,CAACtC,EAAD,CAD/B,EADF,CASD,CAED,cAAeI,CAAAA,QAAf","sourcesContent":["import { useEffect, useState } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\n\nimport userApi from '../../../api/userApi';\nimport { MODE } from '../../../constants';\nimport { ID } from '../constants';\nimport FormContainer from './FormContainer';\nimport { getInitialValues, getRequestPayload } from './converter';\n\nfunction UserForm({ users, setUsers }) {\n  const { mode, id } = useParams();\n  const history = useHistory();\n\n  const user = users.find(user => user.id === Number(id));\n\n  useEffect(() => {\n    if (mode === MODE.VIEW || mode === MODE.EDIT) {\n      if (!user) {\n        userApi\n          .getUser(Number(id))\n          .then(user => setUsers(prevUsers => [...prevUsers, user]))\n          .catch(err => window.alert(err.message));\n      }\n    }\n  }, [id, mode, user, setUsers]);\n\n  const [roles, setRoles] = useState([]);\n  useEffect(() => {\n    userApi.getRoles().then(setRoles);\n  }, [setUsers]);\n\n  const handleSubmit = async values => {\n    try {\n      const payload = getRequestPayload(values);\n\n      switch (mode) {\n        case MODE.CREATE:\n          await userApi.createUser(payload);\n          break;\n        case MODE.EDIT:\n          await userApi.editUser(payload);\n          break;\n        case MODE.CLONE:\n          await userApi.createUser(payload);\n          break;\n        case MODE.DELETE:\n          await userApi.deleteUser(payload);\n          break;\n        default:\n          console.error(`Failed to execute this request for ${mode} mode`);\n      }\n    } catch (err) {\n      window.alert(err.message);\n    }\n\n    history.push('/users');\n  };\n\n  const initialValues = getInitialValues(user);\n\n  return (\n    <FormContainer\n      key={`${mode}:${initialValues[ID]}`}\n      initialValues={initialValues}\n      onSubmit={handleSubmit}\n      mode={mode}\n      roles={roles}\n    />\n  );\n}\n\nexport default UserForm;\n"]},"metadata":{},"sourceType":"module"}